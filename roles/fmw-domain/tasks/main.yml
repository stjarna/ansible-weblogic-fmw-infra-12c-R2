################################################################################
# ==> Creates a Domain with Fussion Middleware 12c R2 Infrastructure software

################################################################################

# ==> Create Repository in Database
- name: "Prepare password response file for repository creation"
  template: 
    src: "passwords.txt" 
    dest: "{{ mw_installer_folder }}"
    owner: "{{ oracle_user }}"
    group: "{{ oracle_group }}"
  tags:
    - "repo"
- name: "Copy create repository script"
  template: 
    src: "create_repo.sh" 
    dest: "{{ mw_installer_folder }}"
    owner: "{{ oracle_user }}" 
    group: "{{ oracle_group }}" 
    mode: "0755"
  tags:
    - "repo"
- name: "Execute create repository script"
  shell: "{{ mw_installer_folder }}/create_repo.sh"
  tags:
    - "repo"
  register: "createRepositoryOutput"

- name: "Debug - createRepositoryOutput"  
  debug:
    var: createRepositoryOutput
  tags: "debug"  
    
# ==> Create new domain
- name: "Copy create domain python script"
  template: 
    src: "create-domain.py" 
    dest: "{{ mw_installer_folder }}" 
    owner: "{{ oracle_user }}" 
    group: "{{ oracle_group }}"
  tags:
    - "create-domain"
- name: "Execute create domain script"
  shell: "{{ weblogic_home }}/common/bin/wlst.sh {{ mw_installer_folder }}/create-domain.py"
  tags:
    - "create-domain"
  register: "createDomainOutput"  
- name: "Debug - createDomainOutput"
  debug:
    var: createDomainOutput
  tags: "debug"  

# ==> Create Environment Variables for Oracle user
- name: "Creates new .bashrc file with system variables"
  template: 
    src: ".bashrc" 
    dest: "/home/oracle/.bashrc"
- name: "Add Oracle Home environment variables"
  lineinfile: 
    dest: "/home/{{ oracle_user }}/.bashrc" 
    line: "export ORACLE_HOME={{ middleware_home }}"
  tags:
    - "oracle-vars"